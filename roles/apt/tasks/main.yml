---
- name: Enable backports for Debian 12 (Bookworm)
  ansible.builtin.lineinfile:
    path: /etc/apt/sources.list
    regexp: '^deb https://deb.debian.org/debian bookworm-backports main'
    line: deb https://deb.debian.org/debian bookworm-backports main

- name: Enable source package backports for Debian 12 (Bookworm)
  ansible.builtin.lineinfile:
    path: /etc/apt/sources.list
    regexp: '^deb-src https://deb.debian.org/debian bookworm-backports main'
    line: deb-src https://deb.debian.org/debian bookworm-backports main

- name: Update the apt cache
  ansible.builtin.apt:
    update_cache: true

- name: Install unattended-upgrade
  ansible.builtin.apt:
    name: unattended-upgrades

- name: Configure unattended-upgrades
  ansible.builtin.copy:
    src: "{{ item }}"
    dest: "/etc/apt/apt.conf.d/{{ item }}"
    owner: root
    group: root
    mode: 0644
  loop:
    - 20auto-upgrades
    - 50unattended-upgrades
